"use strict";var Ie=Object.create;var I=Object.defineProperty;var Ce=Object.getOwnPropertyDescriptor;var Ue=Object.getOwnPropertyNames;var Oe=Object.getPrototypeOf,Le=Object.prototype.hasOwnProperty;var Ne=(t,e)=>{for(var r in e)I(t,r,{get:e[r],enumerable:!0})},ae=(t,e,r,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ue(e))!Le.call(t,n)&&n!==r&&I(t,n,{get:()=>e[n],enumerable:!(a=Ce(e,n))||a.enumerable});return t};var j=(t,e,r)=>(r=t!=null?Ie(Oe(t)):{},ae(e||!t||!t.__esModule?I(r,"default",{value:t,enumerable:!0}):r,t)),De=t=>ae(I({},"__esModule",{value:!0}),t);var st={};Ne(st,{default:()=>Pe});module.exports=De(st);var F=require("@raycast/api");var ce=require("react"),b=require("@raycast/api"),G=require("child_process");var C="Default",U="BRAVE_PROFILE_KEY";var se=`
# \u{1F6A8}Error: Brave browser is not installed
## This extension depends on Brave browser. You must install it to continue.
  
If you have [Homebrew](https://brew.sh/) installed then press \u23CE (Enter Key) to install Brave browser.

[Click here](https://brave.com/download/) if you want to download manually.
  
[![Brave](https://brave.com/static-assets/images/brave-logo.svg)]()
`;var ie=`
# \u{1F6A8}Error: Something happened while trying to run your command
  
[![Brave](https://brave.com/static-assets/images/brave-logo.svg)]()
`,O="An Error Occurred",L="Brave not installed";var le=require("os"),ue=require("path"),N=require("react/jsx-runtime"),Me=(()=>{try{return(0,G.execSync)("brew --prefix",{encoding:"utf8"}).trim()}catch{return(0,le.cpus)()[0].model.includes("Apple")?"/opt/homebrew":"/usr/local"}})();function oe(){return(0,ue.join)(Me,"bin/brew")}function Ve(t){try{return(0,G.execSync)(`${oe()} install --cask ${t}`,{maxBuffer:10*1024*1024})}catch(e){let r=e;throw r&&r.code===127?(r.stderr=`Brew executable not found at ${oe()}`,r):e}}function fe(){let[t,e]=(0,ce.useState)(!0);return(0,N.jsx)(b.Detail,{actions:(0,N.jsx)(b.ActionPanel,{children:t&&(0,N.jsx)(b.ActionPanel.Item,{title:"Install with Homebrew",onAction:async()=>{if(!t)return;let r=new b.Toast({style:b.Toast.Style.Animated,title:"Installing..."});await r.show();try{Ve("brave-browser"),await r.hide()}catch{await r.hide(),await(0,b.showToast)(b.Toast.Style.Failure,O,"An unknown error occurred while trying to install")}r.title="Installed! Please go back and try again.",r.style=b.Toast.Style.Success,await r.show(),e(!1)}})}),markdown:se})}var S=require("@raycast/api");var he=require("react/jsx-runtime");function de(){return(0,S.showToast)(S.Toast.Style.Failure,O,"Something happened while trying to run your command"),(0,he.jsx)(S.Detail,{markdown:ie})}var o=require("@raycast/api");var g=j(require("react")),c=require("@raycast/api");var ye=j(require("node:child_process")),$e=require("node:buffer"),E=j(require("node:stream")),we=require("node:util");var ke=require("react/jsx-runtime");var xe=require("node:url"),K=globalThis;function H(t){let e=(0,g.useRef)(t);return e.current=t,e}function We(t,e){let r=this[t];return r instanceof Date?`__raycast_cached_date__${r.toISOString()}`:Buffer.isBuffer(r)?`__raycast_cached_buffer__${r.toString("base64")}`:e}function Fe(t,e){return typeof e=="string"&&e.startsWith("__raycast_cached_date__")?new Date(e.replace("__raycast_cached_date__","")):typeof e=="string"&&e.startsWith("__raycast_cached_buffer__")?Buffer.from(e.replace("__raycast_cached_buffer__",""),"base64"):e}var Be=Symbol("cache without namespace"),pe=new Map;function M(t,e,r){let a=r?.cacheNamespace||Be,n=pe.get(a)||pe.set(a,new c.Cache({namespace:r?.cacheNamespace})).get(a);if(!n)throw new Error("Missing cache");let s=H(t),i=H(e),l=(0,g.useSyncExternalStore)(n.subscribe,()=>{try{return n.get(s.current)}catch(h){console.error("Could not get Cache data:",h);return}}),f=(0,g.useMemo)(()=>{if(typeof l<"u"){if(l==="undefined")return;try{return JSON.parse(l,Fe)}catch(h){return console.warn("The cached data is corrupted",h),i.current}}else return i.current},[l,i]),u=H(f),p=(0,g.useCallback)(h=>{let m=typeof h=="function"?h(u.current):h;if(typeof m>"u")n.set(s.current,"undefined");else{let T=JSON.stringify(m,We);n.set(s.current,T)}return m},[n,s,u]);return[f,p]}var D=t=>!!t&&typeof t=="object"&&typeof t.removeListener=="function"&&typeof t.emit=="function"&&typeof t.reallyExit=="function"&&typeof t.listeners=="function"&&typeof t.kill=="function"&&typeof t.pid=="number"&&typeof t.on=="function",J=Symbol.for("signal-exit emitter"),Y=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),K[J])return K[J];Object.defineProperty(K,J,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(e,r){this.listeners[e].push(r)}removeListener(e,r){let a=this.listeners[e],n=a.indexOf(r);n!==-1&&(n===0&&a.length===1?a.length=0:a.splice(n,1))}emit(e,r,a){if(this.emitted[e])return!1;this.emitted[e]=!0;let n=!1;for(let s of this.listeners[e])n=s(r,a)===!0||n;return e==="exit"&&(n=this.emit("afterExit",r,a)||n),n}},q=class{onExit(){return()=>{}}load(){}unload(){}},X=class{#o;#t;#e;#s;#i;#a;#n;#r;constructor(e){this.#o=process.platform==="win32"?"SIGINT":"SIGHUP",this.#t=new Y,this.#a={},this.#n=!1,this.#r=[],this.#r.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#r.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#r.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#e=e,this.#a={};for(let r of this.#r)this.#a[r]=()=>{let a=this.#e.listeners(r),{count:n}=this.#t,s=e;if(typeof s.__signal_exit_emitter__=="object"&&typeof s.__signal_exit_emitter__.count=="number"&&(n+=s.__signal_exit_emitter__.count),a.length===n){this.unload();let i=this.#t.emit("exit",null,r),l=r==="SIGHUP"?this.#o:r;i||e.kill(e.pid,l)}};this.#i=e.reallyExit,this.#s=e.emit}onExit(e,r){if(!D(this.#e))return()=>{};this.#n===!1&&this.load();let a=r?.alwaysLast?"afterExit":"exit";return this.#t.on(a,e),()=>{this.#t.removeListener(a,e),this.#t.listeners.exit.length===0&&this.#t.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#n){this.#n=!0,this.#t.count+=1;for(let e of this.#r)try{let r=this.#a[e];r&&this.#e.on(e,r)}catch{}this.#e.emit=(e,...r)=>this.#l(e,...r),this.#e.reallyExit=e=>this.#c(e)}}unload(){this.#n&&(this.#n=!1,this.#r.forEach(e=>{let r=this.#a[e];if(!r)throw new Error("Listener not defined for signal: "+e);try{this.#e.removeListener(e,r)}catch{}}),this.#e.emit=this.#s,this.#e.reallyExit=this.#i,this.#t.count-=1)}#c(e){return D(this.#e)?(this.#e.exitCode=e||0,this.#t.emit("exit",this.#e.exitCode,null),this.#i.call(this.#e,this.#e.exitCode)):0}#l(e,...r){let a=this.#s;if(e==="exit"&&D(this.#e)){typeof r[0]=="number"&&(this.#e.exitCode=r[0]);let n=a.call(this.#e,e,...r);return this.#t.emit("exit",this.#e.exitCode,null),n}else return a.call(this.#e,e,...r)}},Z=null,ze=(t,e)=>(Z||(Z=D(process)?new X(process):new q),Z.onExit(t,e));function je(t,{timeout:e}={}){let r=new Promise((l,f)=>{t.on("exit",(u,p)=>{l({exitCode:u,signal:p,timedOut:!1})}),t.on("error",u=>{f(u)}),t.stdin&&t.stdin.on("error",u=>{f(u)})}),a=ze(()=>{t.kill()});if(e===0||e===void 0)return r.finally(()=>a());let n,s=new Promise((l,f)=>{n=setTimeout(()=>{t.kill("SIGTERM"),f(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},e)}),i=r.finally(()=>{clearTimeout(n)});return Promise.race([s,i]).finally(()=>a())}var Q=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function Ge(t){let{encoding:e}=t,r=e==="buffer",a=new E.default.PassThrough({objectMode:!1});e&&e!=="buffer"&&a.setEncoding(e);let n=0,s=[];return a.on("data",i=>{s.push(i),n+=i.length}),a.getBufferedValue=()=>r?Buffer.concat(s,n):s.join(""),a.getBufferedLength=()=>n,a}async function me(t,e){let r=Ge(e);return await new Promise((a,n)=>{let s=i=>{i&&r.getBufferedLength()<=$e.constants.MAX_LENGTH&&(i.bufferedData=r.getBufferedValue()),n(i)};(async()=>{try{await(0,we.promisify)(E.default.pipeline)(t,r),a()}catch(i){s(i)}})(),r.on("data",()=>{r.getBufferedLength()>8e7&&s(new Q)})}),r.getBufferedValue()}async function be(t,e){t.destroy();try{return await e}catch(r){return r.bufferedData}}async function Ke({stdout:t,stderr:e},{encoding:r},a){let n=me(t,{encoding:r}),s=me(e,{encoding:r});try{return await Promise.all([a,n,s])}catch(i){return Promise.all([{error:i,exitCode:null,signal:i.signal,timedOut:i.timedOut||!1},be(t,n),be(e,s)])}}function He(t){let e=typeof t=="string"?`
`:10,r=typeof t=="string"?"\r":13;return t[t.length-1]===e&&(t=t.slice(0,-1)),t[t.length-1]===r&&(t=t.slice(0,-1)),t}function ge(t,e){return t.stripFinalNewline?He(e):e}function Je({timedOut:t,timeout:e,signal:r,exitCode:a}){return t?`timed out after ${e} milliseconds`:r!=null?`was killed with ${r}`:a!=null?`failed with exit code ${a}`:"failed"}function Ze({stdout:t,stderr:e,error:r,signal:a,exitCode:n,command:s,timedOut:i,options:l,parentError:f}){let p=`Command ${Je({timedOut:i,timeout:l?.timeout,signal:a,exitCode:n})}: ${s}`,h=r?`${p}
${r.message}`:p,m=[h,e,t].filter(Boolean).join(`
`);return r?r.originalMessage=r.message:r=f,r.message=m,r.shortMessage=h,r.command=s,r.exitCode=n,r.signal=a,r.stdout=t,r.stderr=e,"bufferedData"in r&&delete r.bufferedData,r}function Ye({stdout:t,stderr:e,error:r,exitCode:a,signal:n,timedOut:s,command:i,options:l,parentError:f}){if(r||a!==0||n!==null)throw Ze({error:r,exitCode:a,signal:n,stdout:t,stderr:e,command:i,timedOut:s,options:l,parentError:f});return t}function V(t,e){try{let r=i=>i.startsWith("http")?i:`https://${i}`,n=(typeof t=="string"?new xe.URL(r(t)):t).hostname;switch(process.env.FAVICON_PROVIDER??"raycast"){case"none":return{source:e?.fallback??c.Icon.Link,mask:e?.mask};case"apple":return{source:e?.fallback??c.Icon.Link,mask:e?.mask};case"duckduckgo":case"duckDuckGo":return{source:`https://icons.duckduckgo.com/ip3/${n}.ico`,fallback:e?.fallback??c.Icon.Link,mask:e?.mask};case"google":return{source:`https://www.google.com/s2/favicons?sz=${e?.size??64}&domain=${n}`,fallback:e?.fallback??c.Icon.Link,mask:e?.mask};case"legacy":case"raycast":default:return{source:`https://api.ray.so/favicon?url=${n}&size=${e?.size??64}`,fallback:e?.fallback??c.Icon.Link,mask:e?.mask}}}catch(r){return console.error(r),c.Icon.Link}}async function A(t,e,r){if(process.platform!=="darwin")throw new Error("AppleScript is only supported on macOS");let{humanReadableOutput:a,language:n,timeout:s,...i}=Array.isArray(e)?r||{}:e||{},l=a!==!1?[]:["-ss"];n==="JavaScript"&&l.push("-l","JavaScript"),Array.isArray(e)&&l.push("-",...e);let f=ye.default.spawn("osascript",l,{...i,env:{PATH:"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"}}),u=je(f,{timeout:s??1e4});f.stdin.end(t);let[{error:p,exitCode:h,signal:m,timedOut:T},B,k]=await Ke(f,{encoding:"utf8"},u),$=ge({stripFinalNewline:!0},B),z=ge({stripFinalNewline:!0},k);return Ye({stdout:$,stderr:z,error:p,exitCode:h,signal:m,timedOut:T,command:"osascript",options:r,parentError:new Error})}var y=require("@raycast/api");var x=class t{constructor(e,r,a,n,s){this.title=e;this.url=r;this.favicon=a;this.windowsIndex=n;this.tabIndex=s}static{this.TAB_CONTENTS_SEPARATOR="~~~"}static parse(e){let r=e.split(this.TAB_CONTENTS_SEPARATOR);return new t(r[0],r[1],r[2],+r[3],+r[4])}key(){return`${this.windowsIndex}${t.TAB_CONTENTS_SEPARATOR}${this.tabIndex}`}urlWithoutScheme(){return this.url.replace(/(^\w+:|^)\/\//,"").replace("www.","")}googleFavicon(){return V(this.url)}};var ve=require("child_process");async function Se(t){let e=t?`execute of tab _tab_index of window _window_index javascript \xAC
                    "document.head.querySelector('link[rel~=icon]').href;"`:'""';await Te();let{browserOption:r}=(0,y.getPreferenceValues)();return(await A(`
      set _output to ""
      tell application "${r}"
        set _window_index to 1
        repeat with w in windows
          set _tab_index to 1
          repeat with t in tabs of w
            set _title to get title of t
            set _url to get URL of t
            set _favicon to ${e}
            set _output to (_output & _title & "${x.TAB_CONTENTS_SEPARATOR}" & _url & "${x.TAB_CONTENTS_SEPARATOR}" & _favicon & "${x.TAB_CONTENTS_SEPARATOR}" & _window_index & "${x.TAB_CONTENTS_SEPARATOR}" & _tab_index & "\\n")
            set _tab_index to _tab_index + 1
          end repeat
          set _window_index to _window_index + 1
          if _window_index > count windows then exit repeat
        end repeat
      end tell
      return _output
  `)).split(`
`).filter(n=>n.length!==0).map(n=>x.parse(n))}async function w({url:t,query:e,profileCurrent:r,profileOriginal:a,openTabInProfile:n,newWindow:s,incognito:i}){setTimeout(()=>{(0,y.popToRoot)({clearSearchBar:!0})},3e3),await Te()&&(0,y.closeMainWindow)({clearRootSearch:!0});let{browserOption:f}=(0,y.getPreferenceValues)(),u=t||(e?`https://www.google.com/search?q=${encodeURIComponent(e)}`:""),p=k=>new Promise(($,z)=>{(0,ve.exec)(k,ne=>{ne?z(ne):$(!0)})}),h=k=>{let $=[];return k&&$.push(`--profile-directory=${k}`),s&&$.push("--new-window"),i&&$.push("--incognito"),u&&$.push(u),$},m=[];switch(n){case"default":m=h();break;case"profile_current":m=h(r);break;case"profile_original":m=h(a);break}let T=m.map(k=>`"${k}"`).join(" "),B=`open -na "${f}" --args ${T}`;return p(B)}async function ee(t){let{browserOption:e}=(0,y.getPreferenceValues)();await A(`tell application "${e}}"
    tell window 1
      delete tab ${t}
    end tell
  end tell`)}async function Ee(t){let{browserOption:e}=(0,y.getPreferenceValues)();await A(`
    tell application "${e}"
      activate
      set index of window (${t.windowsIndex} as number) to (${t.windowsIndex} as number)
      set active tab index of window (${t.windowsIndex} as number) to (${t.tabIndex} as number)
    end tell
    return true
  `)}var Te=async()=>{let{browserOption:t}=(0,y.getPreferenceValues)();if(await A(`
set isInstalled to false
try
    do shell script "osascript -e 'exists application \\"${t}\\"'"
    set isInstalled to true
end try

return isInstalled`)==="false")throw new Error(L);return!0};var d=require("react/jsx-runtime"),_=class{static{this.NewTab=Xe}static{this.TabList=Qe}static{this.TabHistory=et}};function Xe({query:t,incognito:e}){let{openTabInProfile:r}=(0,o.getPreferenceValues)(),[a]=M(U,C);return(0,d.jsx)(o.ActionPanel,{title:"New Tab",children:(0,d.jsx)(o.Action,{onAction:()=>w({query:t,profileCurrent:a,openTabInProfile:r,incognito:e}),title:t?`Search "${t}"`:"Open New Tab",icon:o.Icon.Globe})})}function Qe({tab:t}){let{openTabInProfile:e}=(0,o.getPreferenceValues)(),[r]=M(U,C);return(0,d.jsxs)(o.ActionPanel,{title:t.title,children:[(0,d.jsx)(tt,{tab:t}),(0,d.jsx)(o.Action,{title:"Move to New Window",icon:o.Icon.Window,onAction:async()=>{await ee(t.tabIndex),await w({url:t.url,profileCurrent:r,openTabInProfile:e,newWindow:!0})}}),(0,d.jsx)(o.Action,{title:"Move to Incognito Window",icon:o.Icon.EyeDisabled,onAction:async()=>{await ee(t.tabIndex),await w({url:t.url,profileCurrent:r,openTabInProfile:e,incognito:!0})}}),(0,d.jsx)(o.Action.CopyToClipboard,{title:"Copy URL",content:t.url})]})}function et({title:t,url:e,profile:r}){let{openTabInProfile:a}=(0,o.getPreferenceValues)(),[n]=M(U,C);return(0,d.jsxs)(o.ActionPanel,{title:t,children:[(0,d.jsx)(o.Action,{onAction:async()=>await w({url:e,profileOriginal:r,profileCurrent:n,openTabInProfile:a}),icon:o.Icon.Eye,title:"Open"}),(0,d.jsx)(o.Action,{title:"Open in New Window",icon:o.Icon.Window,onAction:async()=>await w({url:e,profileOriginal:r,profileCurrent:n,openTabInProfile:a,newWindow:!0})}),(0,d.jsx)(o.Action,{title:"Open in Incognito Window",icon:o.Icon.EyeDisabled,onAction:async()=>await w({url:e,profileOriginal:r,profileCurrent:n,openTabInProfile:a,incognito:!0})}),(0,d.jsxs)(o.ActionPanel.Section,{title:"Open in profile",children:[(0,d.jsx)(o.Action,{onAction:()=>w({url:e,profileOriginal:r,profileCurrent:n,openTabInProfile:"profile_current"}),title:"Open in Current Profile"}),(0,d.jsx)(o.Action,{onAction:()=>w({url:e,profileOriginal:r,profileCurrent:n,openTabInProfile:"profile_original"}),title:"Open in Original Profile"})]}),(0,d.jsx)(o.Action.CopyToClipboard,{title:"Copy URL",content:e,shortcut:{modifiers:["cmd"],key:"c"}})]})}function tt(t){async function e(){await Ee(t.tab),await(0,o.closeMainWindow)()}return(0,d.jsx)(o.ActionPanel.Item,{title:"Open Tab",icon:{source:o.Icon.Eye},onAction:e})}var P=require("@raycast/api");var R=require("react/jsx-runtime"),W=class{static{this.TabList=at}static{this.TabHistory=nt}};function rt(t){try{let e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}}function Ae(t){try{let e=new URL(t),r=e.hostname.replace("www.","").split("."),a=e.pathname.split("/").filter(n=>n.length>0);return[...r,...a,e.hostname,t]}catch{return[t]}}function nt({profile:t,entry:{url:e,title:r,id:a}}){return(0,R.jsx)(P.List.Item,{id:`${t}-${a}`,title:r,subtitle:e,keywords:Ae(e),icon:rt(e)?V(e):P.Icon.Globe,actions:(0,R.jsx)(_.TabHistory,{title:r,url:e,profile:t})})}function at(t){return(0,R.jsx)(P.List.Item,{title:t.tab.title,subtitle:t.tab.urlWithoutScheme(),keywords:Ae(t.tab.url),actions:(0,R.jsx)(_.TabList,{tab:t.tab}),icon:t.useOriginalFavicon?t.tab.favicon:t.tab.googleFavicon()})}var v=require("react");var _e=require("@raycast/api");var te=require("react/jsx-runtime");function Re(t){let{useOriginalFavicon:e}=(0,_e.getPreferenceValues)(),[r,a]=(0,v.useState)([]),[n,s]=(0,v.useState)(!0),[i,l]=(0,v.useState)(),f=(0,v.useCallback)(async()=>{let u=await Se(e);t&&(u=u.filter(p=>p.title.toLowerCase().includes(t.toLowerCase())||p.urlWithoutScheme().toLowerCase().includes(t.toLowerCase()))),a(u)},[t]);return(0,v.useEffect)(()=>{f().then(()=>s(!1)).catch(u=>{u.message===L?l((0,te.jsx)(fe,{})):l((0,te.jsx)(de,{})),s(!1)})},[t]),{data:r,isLoading:n,errorView:i,revalidate:f,profile:{name:"",id:""}}}var re=require("react/jsx-runtime");function Pe(){let{useOriginalFavicon:t}=(0,F.getPreferenceValues)(),{data:e,isLoading:r,errorView:a}=Re();return a||(0,re.jsx)(F.List,{isLoading:r,filtering:!0,children:e?.map(n=>(0,re.jsx)(W.TabList,{tab:n,useOriginalFavicon:t},n.key()))})}
